<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta name="HandheldFriendly" content="true" />
		<meta name="MobileOptimized" content="320" />
		<link rel="stylesheet" href="css/common.css">
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="http://cache.amap.com/lbs/static/main.css?v=1.0" />
		<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=b5a6dea9e006539a5499341b5cf1217f"></script>
		<title>去哪找我</title>
		<style>
			.mui-bar {
				background: #6bbb55;
				color: #fff;
			}
			
			header .mui-title {
				color: #fff;
			}
			
			header .mui-icon-left-nav {
				color: #fff;
			}
			
			header button {
				color: #fff !important;
			}
			.mui-scroll-wrapper{
				top:84px;
				margin: 0;
			}
			.yue {
				padding-top: 200px;
				text-align: center;
				font-size: 60px;
				color: #6bbb55;
			}
			
			.yue p {
				margin-top: 22px;
				color: #6bbb55;
			}
			
			.chongzhi {
				position: absolute;
				bottom: 90px;
				background: #6bbb55;
				color: #fff;
				height: 40px;
				line-height: 40px;
				width: 86%;
				text-align: center;
				left: 7%;
			}
			.content{
				background: #f6f6f6;
				padding: 0;
			}
			.content p {
				height:40px;
				padding: 0;
				line-height: 40px;
				margin: 0;
			}
			.content p span:first-child{
				display: inline-block;
				font-size: 14px;
				font-weight: 400;
				color: #000000;
				text-align: left;
				float: left;
				margin-left:5%;
			}
			.content p span:last-child{
				display: inline-block;
				font-size: 12px;
				color: #6D6D72;
				margin-left:10px;
				float: left;
			}
			.historys{
				width:100%;
			}
			.history{
				width:95%;
				height: 50px;
				margin-left: 5%;
				border-bottom: 1px solid #f8f8f8;
			}
			.history img{
				width:15px;
				height: 15px;
				float: left;
				margin-top: 20px;
				margin-left: 0;
			}
			.hp{
				margin-top: 5px;
			}
			.hp p{
				text-align: left;
				margin: 0;
				margin-left: 25px;
				height:28px;
			}
			.hp p:first-child{
				font-size: 14.2px;
				color: #000000;
				font-weight: 400;
				padding-top:5px ;
			}
			.hp p:last-child{
				font-size: 12px;
				color: #6d6d6d;
			}
			.clearHistory{
				display: block;
				width:100%;
				height: 50px;
				text-align: center;
				line-height: 50px;
				border-bottom: 1px solid #f8f8f8;
				font-size:14px;
			}
			.collections{
				width:100%;
			}
			.collection{
				width:100%;
				border-bottom: 1px solid #f8f8f8;
				overflow: hidden;
			}
			.left{
				width:50%;
				float: left;
				border-right: 1px solid #f8f8f8;
				position: relative;
				z-index: 1;
			}
			.left p{
				width:100%;
				height: 50px;
				font-size: 14.2px;
				font-weight: 400;
				color: #000000;
				margin: 0;
				text-align: left;
				line-height: 50px;
				padding-left: 23%;
			}
			.left span{
				display: none;
			}
			.left img{
				width:20px;
				height: 20px;
				float: left;
				margin-top: 15px;
				margin-left: 10%;
			}
			.right{
				width:50%;
				float: left;
				border-right: 1px solid #f8f8f8;
				position: relative;
			}
			.right p{
				width:100%;
				height: 50px;
				font-size: 14.2px;
				font-weight: 400;
				color: #000000;
				margin: 0;
				text-align: left;
				line-height: 50px;
				padding-left: 23%;
			}
			.right span{
				display: none;
			}
			.right img{
				width:20px;
				height: 20px;
				float: left;
				margin-top: 15px;
				margin-left: 10%;
			}
			.delete{
				display: none;
				position: absolute;
				z-index: 5;
				top:5px;
				width:25%;
				right:10px;
				height: 30px;
				border:1px solid #000000;
				border-radius: 2px;
				text-align: center;
				font-size: 16px;
				line-height: 30px;
			}
			.model{
				position: absolute;
				top:0;
				bottom:0;
				left:0;
				right:0;
				z-index: 2;
				display: none;
			}
			header p{
				display: inline-block;
				color: #FFFFFF;
				font-size:20px;
				margin: 0;
				margin-left: 20px;
			}
			.se{
				font-size: 14px;
			}
			.sss{
				display: inline-block;
				width:85%;
				height: 30px;
				background: #FFFFFF;
				margin-top: 8px;
				float: left;
				border-radius: 5px;
			}
			.sss img{
				width:25px;
				height: 25px;
				float: left;
				margin-right: 15px;
				margin-left: 5px;
				margin-top: 2px;
			}
			#searchBarx{
				width: 80%;
				height: 30px;
				color: #000;
				border: 0;
				margin: 0;
				padding: 0;
				float: left;
				font-size:15px;
			}
			.mui-scroll{
				background: #FFFFFF;
			}
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav">
			<!--<button class="mui-action-back mui-btn mui-btn-link mui-btn-nav mui-pull-left"><span class="mui-icon mui-icon-left-nav"></span>返回</button>-->
			<!--<h1 class="mui-title">搜索</h1>-->
			<div class="sss">
				<img src="img/se.png">
				<input type="text" placeholder="去哪找我" id="searchBarx" autofocus="autofocus"/>
			</div>
			
			<p class="se">取消</p>
		</header>
		<div class="mui-content">
			<div class="content">
				<p><span>我的位置</span><span class="address"></span></p>
			</div>
			<div class="mui-scroll-wrapper">
				<div class="mui-content mui-scroll">
					<div class="collections">
		
					</div>
					<div class="historys">
						
					</div>
					<span class="clearHistory">
						清空历史记录
					</span>
				</div>
			</div>
		</div>
		
		
	</body>
	<script src="js/mui.min.js"></script>
	<script type="text/javascript" src="js/jquery-2.2.0.min.js" ></script>
	<script type="text/javascript" src="js/base.js" ></script>
	<script>
		var address = "";
		var flag = false;
		mui.init({
			gestureConfig:{
				longtap: true,
			}
		});
		if(window.plus) {
			plusReady();
		} else {
			document.addEventListener('plusready', plusReady, false);
		}
		mui('.mui-scroll-wrapper').scroll({
			 scrollY: true, //是否竖向滚动
			 scrollX: false, //是否横向滚动
			 startX: 0, //初始化时滚动至x
			 startY: 0, //初始化时滚动至y
			 indicators: true, //是否显示滚动条
			 deceleration:0.0002, //阻尼系数,系数越小滑动越灵敏
		});
		function plusReady () {
			function map_getClient() {
				$.ajax({
					type: "post",
					url: IP + "/client/info",
					dataType: "json",
					success: function(data) {
						if(data.name=="未登录"){
							if(plus.storage.getItem("login")=="true"){
								$.ajax({
									type: "post",
									url: IP + "/mobile/verificationCheck3",
									dataType: "json",
									data : {"phone":plus.storage.getItem("phone")},
									success: function() {
										$.ajax({
											type: "post",
											url: IP + "/bikeStationCollection/list",
											dataType: "json",
											success: function(data) {
												$(".collection").remove();
												if(data.error){
													
												}else{
													var list = data.list;
													for(var i =0 ;i<list.length;i++){
														var item = list[i];
														var j = Math.floor(i/2);
														if(i%2==0){
															$(".collections").append("<div class='collection' id='"+j+"'>"+
															"<div class='left' id='"+item.id+"'>"+"<img src='img/xx.png'>"+"<p>"+item.name+"</p>"+
															"<span>"+item.lng+"</span>"+"<span>"+item.lat+"</span>"+"<div class='delete' id='d"+item.id+"'>删除</div>"+"<div class='model' id='m"+item.id+"'></div>"+"</div>"+"</div>");
														}else{
															$("#"+j).append(
															"<div class='right' id='"+item.id+"'>"+"<img src='img/xx.png'>"+"<p>"+item.name+"</p>"+
															"<span>"+item.lng+"</span>"+"<span>"+item.lat+"</span>"+"<div class='delete' id='d"+item.id+"'>删除</div>"+"<div class='model' id='m"+item.id+"'></div>"+"</div>");
														}
													}
												}
											},
										});
									},
								});
							}
						}
						else{
							$.ajax({
								type: "post",
								url: IP + "/bikeStationCollection/list",
								dataType: "json",
								success: function(data) {
									$(".collection").remove();
									if(data.error){
										
									}else{
										var list = data.list;
										for(var i =0 ;i<list.length;i++){
											var item = list[i];
											var j = Math.floor(i/2);
											if(i%2==0){
												$(".collections").append("<div class='collection' id='"+j+"'>"+
												"<div class='left' id='"+item.id+"'>"+"<img src='img/xx.png'>"+"<p>"+item.name+"</p>"+
												"<span>"+item.lng+"</span>"+"<span>"+item.lat+"</span>"+"<div class='delete' id='d"+item.id+"'>删除</div>"+"<div class='model' id='m"+item.id+"'></div>"+"</div>"+"</div>");
											}else{
												$("#"+j).append(
												"<div class='right' id='"+item.id+"'>"+"<img src='img/xx.png'>"+"<p>"+item.name+"</p>"+
												"<span>"+item.lng+"</span>"+"<span>"+item.lat+"</span>"+"<div class='delete' id='d"+item.id+"'>删除</div>"+"<div class='model' id='m"+item.id+"'></div>"+"</div>");
											}
										}
									}
								},
							});
						}
					}
				});
			}
			
			map_getClient();
			
			address = plus.webview.currentWebview().address;
			$(".address").text(address);
			$(".history").remove();
			if(JSON.parse(plus.storage.getItem("history"))!=null){
				for(var i=JSON.parse(plus.storage.getItem("history")).length-1; i>=0;i--){
					var item = JSON.parse(plus.storage.getItem("history"))[i];
					$(".historys").append("<div class='history' onclick='search(this)'>"+"<img src='img/dd.png'>"+"<div class='hp'>"+
					"<p>"+item.name+"</p>"+"<p>"+item.address+"</p>"+"</div>"+"</div>");
				}
			}
			AMap.plugin('AMap.Autocomplete', function() {
				var autoOptions = {
					city: "",
					input: "searchBarx"
				};
				autocomplete = new AMap.Autocomplete(autoOptions);
				AMap.event.addListener(autocomplete, "select", function(e) {
					var data=plus.webview.getLaunchWebview();
					mui.fire(data,"doit",{
						search:e.poi.name
					});
					mui.back();
				});
			});
			
			mui(".collections").on('longtap','.left',function(){
				var id = $(this).attr("id");
				$("#d"+id).css("display","inline-block");
				$("#m"+id).css("display","block");
			});
			
			mui(".collections").on('longtap','.right',function(){
				var id = $(this).attr("id");
				$("#d"+id).css("display","inline-block");
				$("#m"+id).css("display","block");
			});
			
			$(".collections").on('tap','.delete',function(){
				var id = $(this).attr("id");
				var id1 = id.substring(1,id.length);
				$.ajax({
					type: "post",
					url: IP + "/bikeStationCollection/delete",
					dataType: "json",
					data:{"id":id1},
					success: function() {
						map_getClient();
						$("#d"+id1).css("display","none");
						$("#m"+id1).css("display","none");
					}
				});
				return false;
			});
			$(".sss img").click(function(){
				var name = $("#searchBarx").val();
				if(name!=""){
					var data=plus.webview.getLaunchWebview();
					mui.fire(data,"doit",{
						search:name
					});
					mui.back();
				}else{
					plus.nativeUI.alert("请输入搜索地址");
				}
			});
		}
		
		function search(e){
			var name = $(e).find("p").eq(0).text();
			var data=plus.webview.getLaunchWebview();
			mui.fire(data,"doit",{
				search:name
			});
			mui.back();
		}
		$(".collections").on('tap','.left',function(){
			var lng = $(this).find("span").eq(0).text();
			var lat = $(this).find("span").eq(1).text();
			var data=plus.webview.getLaunchWebview();
			mui.fire(data,"doit2",{
				lng:lng,
				lat:lat
			});
			mui.back();
		});
		$(".collections").on('tap','.model',function(){
			return false;
		});
		$(".collections").on('tap','.right',function(){
			var lng = $(this).find("span").eq(0).text();
			var lat = $(this).find("span").eq(1).text();
			var data=plus.webview.getLaunchWebview();
			mui.fire(data,"doit2",{
				lng:lng,
				lat:lat
			});
			mui.back();
		});
		
		$(".clearHistory").click(function(){
			plus.storage.removeItem("history");
			$(".history").remove();
		});
		
		$(".se").click(function(){
			mui.back();
		});
	</script>

</html>